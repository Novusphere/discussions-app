(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{1539:function(t,i,e){"use strict";t.exports=function(t){return t!=t}},1557:function(t,i,e){"use strict";e.r(i);var n=e(1339),s=e.n(n);var o={TAB:9,ENTER:13,ESCAPE:27,UP:38,DOWN:40};e(1317);const h=s.a.import("blots/embed");class a extends h{static create(t){const i=super.create(),e=document.createElement("span");return e.className="ql-mention-denotation-char",e.innerHTML=t.denotationChar,i.appendChild(e),i.innerHTML+=t.value,a.setDataValues(i,t)}static setDataValues(t,i){const e=t;return Object.keys(i).forEach(t=>{e.dataset[t]=i[t]}),e}static value(t){return t.dataset}}a.blotName="mention",a.tagName="span",a.className="mention",s.a.register(a);const r=e(1539);class l{constructor(t,i){this.isOpen=!1,this.itemIndex=0,this.mentionCharPos=null,this.cursorPos=null,this.values=[],this.suspendMouseEnter=!1,this.quill=t,this.options={source:null,renderItem:(t,i)=>`${t.value}`,onSelect(t,i){i(t)},mentionDenotationChars:["@"],showDenotationChar:!0,allowedChars:/^[a-zA-Z0-9_]*$/,minChars:0,maxChars:31,offsetTop:2,offsetLeft:0,isolateCharacter:!1,fixMentionsToQuill:!1,defaultMenuOrientation:"bottom",dataAttributes:["id","value","denotationChar","link","target"],linkTarget:"_blank",onOpen:()=>!0,onClose:()=>!0,listItemClass:"ql-mention-list-item",mentionContainerClass:"ql-mention-list-container",mentionListClass:"ql-mention-list"},Object.assign(this.options,i,{dataAttributes:Array.isArray(i.dataAttributes)?this.options.dataAttributes.concat(i.dataAttributes):this.options.dataAttributes}),this.mentionContainer=document.createElement("div"),this.mentionContainer.className=this.options.mentionContainerClass?this.options.mentionContainerClass:"",this.mentionContainer.style.cssText="display: none; position: absolute;",this.mentionContainer.onmousemove=this.onContainerMouseMove.bind(this),this.options.fixMentionsToQuill&&(this.mentionContainer.style.width="auto"),this.mentionList=document.createElement("ul"),this.mentionList.className=this.options.mentionListClass?this.options.mentionListClass:"",this.mentionContainer.appendChild(this.mentionList),this.quill.container.appendChild(this.mentionContainer),t.on("text-change",this.onTextChange.bind(this)),t.on("selection-change",this.onSelectionChange.bind(this)),t.keyboard.addBinding({key:o.TAB},this.selectHandler.bind(this)),t.keyboard.bindings[9].unshift(t.keyboard.bindings[9].pop()),t.keyboard.addBinding({key:o.ENTER},this.selectHandler.bind(this)),t.keyboard.bindings[13].unshift(t.keyboard.bindings[13].pop()),t.keyboard.addBinding({key:o.ESCAPE},this.escapeHandler.bind(this)),t.keyboard.addBinding({key:o.UP},this.upHandler.bind(this)),t.keyboard.addBinding({key:o.DOWN},this.downHandler.bind(this))}selectHandler(){return!this.isOpen||(this.selectItem(),!1)}escapeHandler(){return!this.isOpen||(this.hideMentionList(),!1)}upHandler(){return!this.isOpen||(this.prevItem(),!1)}downHandler(){return!this.isOpen||(this.nextItem(),!1)}showMentionList(){this.mentionContainer.style.visibility="hidden",this.mentionContainer.style.display="",this.setMentionContainerPosition(),this.setIsOpen(!0)}hideMentionList(){this.mentionContainer.style.display="none",this.setIsOpen(!1)}highlightItem(t=!0){for(let t=0;t<this.mentionList.childNodes.length;t+=1)this.mentionList.childNodes[t].classList.remove("selected");if(this.mentionList.childNodes[this.itemIndex].classList.add("selected"),t){const t=this.mentionList.childNodes[this.itemIndex].offsetHeight,i=this.itemIndex*t,e=this.mentionContainer.scrollTop,n=e+this.mentionContainer.offsetHeight;i<e?this.mentionContainer.scrollTop=i:i>n-t&&(this.mentionContainer.scrollTop+=i-n+t)}}getItemData(){const{link:t}=this.mentionList.childNodes[this.itemIndex].dataset,i=void 0!==t,e=this.mentionList.childNodes[this.itemIndex].dataset.target;return i&&(this.mentionList.childNodes[this.itemIndex].dataset.value=`<a href="${t}" target=${e||this.options.linkTarget}>${this.mentionList.childNodes[this.itemIndex].dataset.value}`),this.mentionList.childNodes[this.itemIndex].dataset}onContainerMouseMove(){this.suspendMouseEnter=!1}selectItem(){const t=this.getItemData();this.options.onSelect(t,t=>{this.insertItem(t)}),this.hideMentionList()}insertItem(t){const i=t;null!==i&&(this.options.showDenotationChar||(i.denotationChar=""),this.quill.deleteText(this.mentionCharPos,this.cursorPos-this.mentionCharPos,s.a.sources.USER),this.quill.insertEmbed(this.mentionCharPos,"mention",i,s.a.sources.USER),this.quill.insertText(this.mentionCharPos+1," ",s.a.sources.USER),this.quill.setSelection(this.mentionCharPos+2,s.a.sources.USER),this.hideMentionList())}onItemMouseEnter(t){if(this.suspendMouseEnter)return;const i=Number(t.target.dataset.index);r(i)||i===this.itemIndex||(this.itemIndex=i,this.highlightItem(!1))}onItemClick(t){t.stopImmediatePropagation(),t.preventDefault(),this.itemIndex=t.currentTarget.dataset.index,this.highlightItem(),this.selectItem()}attachDataValues(t,i){const e=t;return Object.keys(i).forEach(t=>{this.options.dataAttributes.indexOf(t)>-1?e.dataset[t]=i[t]:delete e.dataset[t]}),e}renderList(t,i,e){if(i&&i.length>0){this.values=i,this.mentionList.innerHTML="";for(let n=0;n<i.length;n+=1){const s=document.createElement("li");s.className=this.options.listItemClass?this.options.listItemClass:"",s.dataset.index=n,s.innerHTML=this.options.renderItem(i[n],e),s.onmouseenter=this.onItemMouseEnter.bind(this),s.dataset.denotationChar=t,s.onclick=this.onItemClick.bind(this),this.mentionList.appendChild(this.attachDataValues(s,i[n]))}this.itemIndex=0,this.highlightItem(),this.showMentionList()}else this.hideMentionList()}nextItem(){this.itemIndex=(this.itemIndex+1)%this.values.length,this.suspendMouseEnter=!0,this.highlightItem()}prevItem(){this.itemIndex=(this.itemIndex+this.values.length-1)%this.values.length,this.suspendMouseEnter=!0,this.highlightItem()}hasValidChars(t){return this.options.allowedChars.test(t)}containerBottomIsNotVisible(t,i){return t+this.mentionContainer.offsetHeight+i.top>window.pageYOffset+window.innerHeight}containerRightIsNotVisible(t,i){if(this.options.fixMentionsToQuill)return!1;return t+this.mentionContainer.offsetWidth+i.left>window.pageXOffset+document.documentElement.clientWidth}setIsOpen(t){this.isOpen!==t&&(t?this.options.onOpen():this.options.onClose(),this.isOpen=t)}setMentionContainerPosition(){const t=this.quill.container.getBoundingClientRect(),i=this.quill.getBounds(this.mentionCharPos),e=this.mentionContainer.offsetHeight;let n=this.options.offsetTop,s=this.options.offsetLeft;if(this.options.fixMentionsToQuill){const t=0;this.mentionContainer.style.right=`${t}px`}else s+=i.left;if(this.containerRightIsNotVisible(s,t)){const i=this.mentionContainer.offsetWidth+this.options.offsetLeft;s=t.width-i}if("top"===this.options.defaultMenuOrientation){if(n=this.options.fixMentionsToQuill?-1*(e+this.options.offsetTop):i.top-(e+this.options.offsetTop),n+t.top<=0){let e=this.options.offsetTop;this.options.fixMentionsToQuill?e+=t.height:e+=i.bottom,n=e}}else if(this.options.fixMentionsToQuill?n+=t.height:n+=i.bottom,this.containerBottomIsNotVisible(n,t)){let t=-1*this.options.offsetTop;this.options.fixMentionsToQuill||(t+=i.top),n=t-e}this.mentionContainer.style.top=`${n}px`,this.mentionContainer.style.left=`${s}px`,this.mentionContainer.style.visibility="visible"}onSomethingChange(){const t=this.quill.getSelection();if(null==t)return;this.cursorPos=t.index;const i=Math.max(0,this.cursorPos-this.options.maxChars),e=this.quill.getText(i,this.cursorPos-i),n=this.options.mentionDenotationChars.reduce((t,i)=>{const n=t,s=e.lastIndexOf(i);return s>n?s:n},-1);if(n>-1){if(this.options.isolateCharacter&&0!==n&&!e[n-1].match(/\s/g))return void this.hideMentionList();const t=this.cursorPos-(e.length-n);this.mentionCharPos=t;const i=e.substring(n+1);if(i.length>=this.options.minChars&&this.hasValidChars(i)){const t=e[n];this.options.source(i,this.renderList.bind(this,t),t)}else this.hideMentionList()}else this.hideMentionList()}onTextChange(t,i,e){"user"===e&&this.onSomethingChange()}onSelectionChange(t){t&&0===t.length?this.onSomethingChange():this.hideMentionList()}}s.a.register("modules/mention",l);i.default=l}}]);