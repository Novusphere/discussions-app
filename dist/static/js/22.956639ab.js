(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1548:function(e,t,a){"use strict";a.r(t);var n=a(16),o=a.n(n),r=a(2),s=a.n(r),i=a(4),l=a.n(i),c=a(0),u=a.n(c),p=a(22),d=a(12),m=a(70),b=a(298),g=a(10),h=a(217),v=a(1329),f=a(1322),y=a(105),w=a(1328),P=a(1323),E=a(222),k=a(5),T=a.n(k),C=a(65),x=a.n(C),N=a(11),U=a(25),V=a(39),j=a(28),O=a.n(j),R=a(61),F=a(1332),S=a.n(F),I=a(90),A=a(35),D=Object(R.a)((function(e){var t=e.thread,a=e.url,n=e.query,r=n.tag,i=n.id,k=(n.title,Object(U.c)()),C=k.userStore,j=(k.settingStore,k.authStore),R=k.uiStore,F=k.walletStore,S=k.tagStore,D=Object(p.d)((function(e){return{observableThread:e.thread,myVote:e.thread.openingPost.myVote,downvotes:e.thread.openingPost.downvotes,upvotes:e.thread.openingPost.upvotes,highlightedPostUUID:"",showPreview:!1,get myVoteValue(){return D.myVote&&D.myVote.length?D.myVote[0].value:0},get threadUsers(){return x.a.uniqBy(x.a.map(x.a.filter(D.observableThread.map,(function(e){return e.pub.length})),(function(e){var t=e.poster;return"eosforumanon"===t&&(t=e.displayName),{id:"".concat(e.pub,"-").concat(e.uidw),value:t,icon:e.imageData}})),(function(e){return e.id}))},setHighlightedPosUUID:function(e){D.highlightedPostUUID=e},editing:!1,submitEditLoading:!1,titleContent:e.thread.openingPost.title,editingContent:e.thread.openingPost.content,setTitleContent:function(e){D.titleContent=e.target.value},setEditingContent:function(e){D.editingContent=e},togglePreview:function(){D.showPreview=!D.showPreview},toggleEdit:function(){D.editing=!D.editing},submitEdit:(r=l()(s.a.mark((function e(){var a,n,o,r,i,c,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D.submitEditLoading=!0,a=Object(N.f)({title:D.titleContent,content:D.editingContent,sub:t.openingPost.sub,parentUuid:t.openingPost.uuid,threadUuid:t.openingPost.threadUuid,uidw:j.uidwWalletPubKey,pub:t.openingPost.pub,posterName:j.displayName,postPub:j.postPub,postPriv:j.postPriv,isEdit:!0}),e.prev=2,n=Object(N.u)({privKey:j.postPriv,uuid:a.uuid,content:a.content}),o=n.sig,a.sig=o,e.next=7,d.b.post(a);case 7:return r=e.sent,i=r.editedAt,c=r.uuid,e.abrupt("return",new Promise((function(e,t){var n=setInterval(l()(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.b.wasEditSubmitted(D.observableThread.openingPost.transaction,c);case 2:if(!t.sent){t.next=14;break}return clearInterval(n),a.myVote=[{value:1}],D.toggleEdit(),D.submitEditLoading=!1,D.titleContent=a.title,D.setEditingContent(a.content),D.observableThread.openingPost.edit=!0,D.observableThread.openingPost.editedAt=i,R.showToast("Success","Your edit was submitted","success"),t.abrupt("return",e());case 14:case"end":return t.stop()}}),t)}))),2e3)})));case 13:return e.prev=13,e.t0=e.catch(2),u="Your reply failed to submit",e.t0.message&&(u=e.t0.message),D.submitEditLoading=!1,R.showToast("Failed",u,"error"),e.abrupt("return",e.t0);case 20:case"end":return e.stop()}}),e,null,[[2,13]])}))),function(){return r.apply(this,arguments)}),replying:!0,submitReplyLoading:!1,replyingContent:"",setReplyContent:function(e){D.replyingContent=e},toggleReply:function(){D.replying=!D.replying},waitForUserInput:function(e){var t=setInterval((function(){if(R.activeModal===V.a.none)return clearInterval(t),e("incomplete");var a=j.TEMP_WalletPrivateKey;return a?(clearInterval(t),e(a)):void 0}),250)},submitReply:(o=l()(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,j.hasAccount){e.next=3;break}return e.abrupt("return",R.showToast("Failed","Please log in to reply","error"));case 3:if(D.submitReplyLoading=!0,!((t=Object(N.f)({title:"",content:D.replyingContent,sub:D.observableThread.openingPost.sub,parentUuid:D.observableThread.openingPost.uuid,threadUuid:D.observableThread.openingPost.threadUuid,uidw:j.uidwWalletPubKey,pub:D.observableThread.openingPost.pub,posterName:j.displayName,postPub:j.postPub,postPriv:j.postPriv})).transfers.length>0)){e.next=10;break}R.setActiveModal(V.a.walletActionPasswordReentry),D.waitForUserInput(function(){var e=l()(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("incomplete"!==a){e.next=4;break}return D.submitReplyLoading=!1,R.showToast("Failed","User cancelled transaction","error"),e.abrupt("return");case 4:return n="".concat(a),j.setTEMPPrivateKey(""),R.clearActiveModal(),D.observableThread.openingPost.tips||(D.observableThread.openingPost.tips={}),t.transfers=Object(N.w)(t.transfers,D.observableThread.openingPost.uidw,n,F.supportedTokensForUnifiedWallet),e.next=11,D.finishSubmitting(t);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=12;break;case 10:return e.next=12,D.finishSubmitting(t);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[0,14]])}))),function(){return o.apply(this,arguments)}),finishSubmitting:(n=l()(s.a.mark((function e(t){var a,n,o,r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object(N.u)({privKey:j.postPriv,uuid:t.uuid,content:t.content}),n=a.sig,t.sig=n,e.next=5,d.b.post(t);case 5:o=e.sent,r=o.transaction,t.myVote=[{value:1}],D.observableThread.openingPost.replies.push(t),D.observableThread.openingPost.totalReplies+=1,D.submitReplyLoading=!1,D.setReplyContent(""),D.toggleReply(),R.showToast("Success","Your reply has been submitted","success",{btn:u.a.createElement(m.a,{size:"small",onClick:function(){return Object(N.s)("https://eosq.app/tx/".concat(r))}},"View transaction")}),e.next=23;break;case 16:return e.prev=16,e.t0=e.catch(0),i="Your reply failed to submit",e.t0.message&&(i=e.t0.message),D.submitReplyLoading=!1,R.showToast("Failed",i,"error"),e.abrupt("return",e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,16]])}))),function(e){return n.apply(this,arguments)}),handleVoting:(a=l()(s.a.mark((function e(t,a,n){var o,r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j.hasAccount){e.next=2;break}return e.abrupt("return",R.showToast("Error","Please log in to vote","error"));case 2:e.t0=n,e.next=1===e.t0?5:-1===e.t0?7:9;break;case 5:return o="upvote",e.abrupt("break",9);case 7:return o="downvote",e.abrupt("break",9);case 9:return e.prev=9,1===(r=D.myVoteValue)&&("downvote"===o&&(D.upvotes-=1,D.downvotes+=1,D.myVote=[{value:-1}]),"upvote"===o&&(D.upvotes-=1,D.myVote=[{value:0}])),-1===r&&("downvote"===o&&(D.upvotes+=1,D.myVote=[{value:0}]),"upvote"===o&&(D.upvotes+=1,D.downvotes-=1,D.myVote=[{value:1}])),0===r&&("downvote"===o&&(D.downvotes+=1,D.myVote=[{value:-1}]),"upvote"===o&&(D.upvotes+=1,D.myVote=[{value:1}])),i=Object(N.i)({uuid:a,postPriv:j.postPriv,value:D.myVoteValue}),e.next=17,Object(N.z)({voter:"",uuid:a,value:D.myVoteValue,nonce:i.nonce,pub:i.pub,sig:i.sig});case 17:e.sent.error&&R.showToast("Failed","Failed to ".concat(o.split("s")[0]," this post"),"error"),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(9),R.showToast("Failed",e.t1.message,"error");case 24:case"end":return e.stop()}}),e,null,[[9,21]])}))),function(e,t,n){return a.apply(this,arguments)})};var a,n,o,r}),{thread:t}),L=Object(I.g)();Object(c.useEffect)((function(){var e=L.pathname.split("#"),t=o()(e,2)[1];return t&&D.setHighlightedPosUUID(t),function(){D.setHighlightedPosUUID("")}}),[]);var z=D.observableThread.openingPost.pub==j.postPub,M=u.a.createElement(b.a,null,u.a.createElement(b.a.Item,null,u.a.createElement("a",{className:"flex flex-row items-center",target:"_blank",rel:"noopener noreferrer",onClick:function(){return C.toggleBlockPost(a)}},u.a.createElement(g.a,{type:"delete",className:"mr2",theme:"twoTone",twoToneColor:"#E7040F"}),C.blockedPosts.has(a)?"Unblock post":"Block post")),!z&&u.a.createElement(b.a.Item,null,u.a.createElement("a",{className:"flex flex-row items-center",target:"_blank",rel:"noopener noreferrer",onClick:function(){return C.setModerationMemberByTag("".concat(t.openingPost.displayName,":").concat(t.openingPost.pub),t.openingPost.sub)}},u.a.createElement(g.a,{type:"safety-certificate",theme:"twoTone",className:"mr2",twoToneColor:"#D5008F"}),C.delegated.has("".concat(t.openingPost.displayName,":").concat(t.openingPost.pub,":").concat(t.openingPost.sub))?"Remove":"Add"," ",t.openingPost.displayName," as moderator")),u.a.createElement(b.a.Item,null,u.a.createElement("a",{className:"flex flex-row items-center",target:"_blank",rel:"noopener noreferrer",onClick:function(){return C.togglePinPost(r,a)}},u.a.createElement(g.a,{type:"pushpin",className:"mr2",theme:"twoTone",twoToneColor:"#FFD700"}),C.pinnedPosts.has(a)?"Un-pin thread":"Pin this thread")));if(C.blockedPosts.has(a)&&"hidden"===C.blockedContentSetting)return u.a.createElement(v.a,{icon:u.a.createElement(g.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"#FF4136"}),title:"This post is blocked!",subTitle:"You or a moderator marked this post as spam. You can unblock this post in your settings.",extra:[u.a.createElement(A.b,{to:"/tag/".concat(t.openingPost.sub)},u.a.createElement(m.a,{title:"See all posts in ".concat(r),icon:"caret-left",type:"primary"},"Back to #",r))]});var Y=S.tagModelFromObservables(t.openingPost.sub);return Y?u.a.createElement(u.a.Fragment,null,u.a.createElement(A.b,{to:"/tag/".concat(t.openingPost.sub)},u.a.createElement(m.a,{title:"See all posts in ".concat(r),icon:"caret-left"},u.a.createElement("span",{className:"flex flex-row items-center"},u.a.createElement("img",{className:"dib",src:Y.logo,alt:"".concat(t.openingPost.sub," icon"),width:25}),u.a.createElement("span",{className:"dib ml1"},"#",r)))),u.a.createElement("div",{className:"bg-white mv2 pa4 card"},u.a.createElement("div",{className:"flex flex-row items-center justify-between"},u.a.createElement("div",{className:"flex flex-row items-center"},u.a.createElement(A.b,{to:"/tag/".concat(t.openingPost.sub)},u.a.createElement("span",{className:"b"},"#",t.openingPost.sub)),u.a.createElement(f.a,{type:"vertical"}),u.a.createElement(E.E,{imageData:t.openingPost.imageData,pub:t.openingPost.pub,name:t.openingPost.displayName}),u.a.createElement(f.a,{type:"vertical"}),u.a.createElement(y.a,{title:T()(D.observableThread.openingPost.edit?D.observableThread.openingPost.editedAt:D.observableThread.openingPost.createdAt).format("YYYY-MM-DD HH:mm:ss")},u.a.createElement("span",{className:"light-silver f6"},D.observableThread.openingPost.edit&&"edited "," ",T()(D.observableThread.openingPost.edit?D.observableThread.openingPost.editedAt:D.observableThread.openingPost.createdAt).fromNow()))),u.a.createElement(E.C,{tips:t.openingPost.tips})),u.a.createElement("div",{className:O()(["mv3 flex-row justify-between",{dn:D.editing,flex:!D.editing}])},u.a.createElement("span",{className:"measure black b f4 flex-wrap"},D.titleContent),u.a.createElement(E.F,{uuid:t.openingPost.uuid,myVote:D.myVoteValue,upVotes:D.upvotes,downVotes:D.downvotes,handler:D.handleVoting})),u.a.createElement("div",{className:"mt2 db"},!D.editing&&u.a.createElement(E.t,{hideFade:!0,className:"black f6 lh-copy overflow-break-word"},D.editingContent),D.editing&&u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"mb3 db"},u.a.createElement(w.a,{autoCorrect:"none",allowClear:!0,size:"large",defaultValue:D.titleContent,onChange:D.setTitleContent})),u.a.createElement(E.a,{onChange:D.setEditingContent,value:D.editingContent,threadUsers:D.threadUsers}),u.a.createElement("div",{className:"flex flex-row justify-end pt2"},u.a.createElement(m.a,{onClick:D.toggleEdit,className:"mr2"},"Cancel"),u.a.createElement(m.a,{disabled:""===D.editingContent,type:"danger",onClick:D.submitEdit,loading:D.submitEditLoading},"Save Edit")))),!D.editing&&u.a.createElement("div",{className:"mt2 flex flex-row justify-between"},u.a.createElement("div",{className:"flex flex-row items-center"},u.a.createElement(m.a,{disabled:D.editing,size:"small",type:"primary",className:"mr1",onClick:D.toggleReply},u.a.createElement(E.j.ReplyIcon,null),"Reply"),z&&u.a.createElement(m.a,{type:D.editing?"danger":"default",size:"small",className:"mr1",onClick:D.toggleEdit},u.a.createElement(g.a,{type:"edit",theme:"filled"}),"Edit"),j.hasAccount&&u.a.createElement(m.a,{size:"small",title:C.watching.has(i)?"Unwatch post":"Watch post",className:"mh1",onClick:function(){return C.toggleThreadWatch(i,D.observableThread.openingPost.totalReplies)}},u.a.createElement(g.a,{type:C.watching.has(i)?"eye":"eye-invisible",theme:C.watching.has(i)?"filled":"outlined",style:{color:C.watching.has(i)?"#079e99":"inherit"}})),u.a.createElement(m.a,{size:"small",title:"View block",className:"mh1",icon:"link",onClick:function(){return Object(N.s)("https://eosq.app/tx/".concat(D.observableThread.openingPost.transaction))}}),u.a.createElement(P.a,{title:"Share this post",content:u.a.createElement(E.z,{url:a}),placement:"bottom"},u.a.createElement(m.a,{size:"small",title:"Share post",className:"mh1",icon:"share-alt",onClick:function(){return Object(N.s)("https://eosq.app/tx/".concat(D.observableThread.openingPost.transaction))}}))),j.hasAccount&&u.a.createElement((function(){return u.a.createElement(h.a,{key:"more",overlay:M},u.a.createElement(m.a,{size:"small",icon:"ellipsis",title:"View more options",disabled:D.editing}))}),{key:"more"}))),D.replying&&u.a.createElement("div",{className:"mt3",id:"reply"},u.a.createElement(E.a,{disabled:D.editing,onChange:D.setReplyContent,threadUsers:D.threadUsers}),u.a.createElement("div",{className:"flex flex-row justify-end pt2"},u.a.createElement(m.a,{disabled:""===D.replyingContent||!j.hasAccount,onClick:D.togglePreview,className:"mr2"},"Preview"),u.a.createElement(m.a,{disabled:""===D.replyingContent||!j.hasAccount,type:"primary",onClick:D.submitReply,loading:D.submitReplyLoading},"Post Reply"))),D.showPreview&&u.a.createElement(E.s,{content:D.replyingContent}),D.observableThread.openingPost.totalReplies>0&&u.a.createElement("div",{className:"mt3",id:"comments"},u.a.createElement("span",{className:"silver"},"viewing all ",D.observableThread.openingPost.totalReplies," comments"),u.a.createElement("div",{className:"mt2 bg-white pv2 card"},D.observableThread.openingPost.replies.map((function(e){return u.a.createElement(E.r,{key:e.uuid,reply:e,threadUsers:D.threadUsers,highlightedPostUUID:D.highlightedPostUUID,setHighlightedPosUUID:D.setHighlightedPosUUID})}))))):null}));t.default=Object(R.a)((function(){var e=Object(U.c)(),t=e.postsStore,a=e.authStore,n=Object(I.h)(),r=Object(c.useState)(null),s=o()(r,2),i=s[0],l=s[1],p=Object(c.useState)(""),d=o()(p,2),m=d[0],b=d[1],g=Object(c.useCallback)((function(){t.getThreadById(n.id,a.postPub).then((function(e){l(e),Object(N.n)(e.openingPost).then((function(e){return b(e)}))}))}),[n.id]);return Object(c.useEffect)((function(){g()}),[n.id]),i?u.a.createElement(u.a.Fragment,null,u.a.createElement(S.a,null,u.a.createElement("title",null,i.openingPost.title," - #",i.openingPost.sub)),u.a.createElement(D,{thread:i,url:m,query:n})):null}))}}]);