(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1544:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a.n(n),l=a(4),s=a.n(l),c=a(16),i=a.n(c),u=a(0),o=a.n(u),m=a(162),p=a(70),b=a(1326),d=a(1328),f=a(25),g=a(22),v=a(299),h=a(11),w=a(12),E=a(1332),O=a.n(E),j=a(90),P=m.a.Option,k=b.a.create({name:"NewPost"})((function(e){var t=e.form,a=e.prefilledTag,n=t.getFieldDecorator,l=Object(f.c)(),c=l.tagStore,E=l.authStore,O=l.uiStore,k=l.userStore,y=Object(u.useState)(!1),N=i()(y,2),x=N[0],S=N[1],F=Object(u.useState)(!1),C=i()(F,2),I=C[0],T=C[1],V=Object(u.useState)(c.tagsWithoutBaseOptions),D=i()(V,2),q=D[0],z=(D[1],Object(u.useState)(null)),W=i()(z,2),J=W[0],K=W[1],U=Object(u.useCallback)((function(){return T(!I)}),[]),A=Object(j.f)(),B=Object(u.useCallback)((function(e){S(!0),e.preventDefault(),t.validateFields(function(){var e=s()(r.a.mark((function e(t,a){var n,l,c,u,m,b,d,f,g,v,j,P,y,N,x;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=24;break}return T(!1),n=a.tag,l=a.title,c=a.content,"#"===n[0]&&(u=n.split("#"),m=i()(u,2),b=m[1],n=b),d=Object(h.h)(),f=Object(h.i)({uuid:d,postPriv:E.postPriv,value:1}),g=f.data,v=Object(h.f)({title:l,content:c,sub:n,parentUuid:"",uuid:d,threadUuid:d,uidw:E.uidwWalletPubKey,pub:"",posterName:E.displayName,skipId:!0,postPub:E.postPub,postPriv:E.postPriv}),j=Object(h.u)({privKey:E.postPriv,uuid:v.uuid,content:v.content}),P=j.sig,v.vote=g,v.sig=P,e.prev=10,e.next=13,w.b.post(v);case 13:return y=e.sent,N=w.b.checkIfPostIsValid(y),e.abrupt("return",new Promise((function(e,t){if(N)var a=Object(h.g)(y),n=setInterval(s()(r.a.mark((function t(){var l,s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.b.getThread(a,E.postPub);case 2:if(!t.sent){t.next=15;break}if(!n){t.next=15;break}return clearInterval(n),S(!1),t.next=9,Object(h.t)(y);case 9:l=t.sent,s=Object(h.g)(y.openingPost),k.toggleThreadWatch(s,0,!0),O.showToast("Success","Your post has been successfully created","success",{btn:o.a.createElement(p.a,{size:"small",onClick:function(){return Object(h.s)("https://bloks.io/transaction/".concat(y.transaction))}},"View transaction")}),A.push(l),e();case 15:case"end":return t.stop()}}),t)}))),2e3)})));case 18:return e.prev=18,e.t0=e.catch(10),x=e.t0.message||"Failed to create a new post",O.showToast("Failed",x,"error"),S(!1),e.abrupt("return",e.t0);case 24:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t,a){return e.apply(this,arguments)}}())}),[]),M=Object(u.useCallback)((function(e){if(e&&e.length>0){if(q.find((function(t){return t.value===e})))return;"#"!==e[0]&&(e="#".concat(e)),K(e)}}),[]);return Object(g.e)((function(){return o.a.createElement("div",{className:"w-100 bg-white card pa4"},o.a.createElement("span",{className:"f5 b db mb3"},"Create a new post in"),o.a.createElement(b.a,{onSubmit:function(){return console.log("hey")}},o.a.createElement(b.a.Item,null,n("tag",{initialValue:a,rules:[{required:!0,message:"Please select a tag"}]})(o.a.createElement(m.a,{size:"large",showSearch:!0,style:{width:"100%"},placeholder:"Enter a tag i.e. #eos",onSearch:M},J&&0===q.filter((function(e){return e===J})).length&&o.a.createElement(P,{key:J,value:J},o.a.createElement("img",{src:"https://cdn.novusphere.io/static/atmos.svg",title:"".concat(J," icon"),className:"mr2 dib",width:15}),J),q.map((function(e){var t=c.tagModelFromObservables(e.value);return t?o.a.createElement(P,{key:e.value,value:e.value},o.a.createElement("img",{src:t.logo,title:"".concat(t.name," icon"),className:"mr2 dib",width:15}),e.label):null}))))),o.a.createElement(b.a.Item,null,n("title",{rules:[{required:!0,message:"Please enter a title for your post"}]})(o.a.createElement(d.a,{size:"large",placeholder:"Post title"}))),o.a.createElement(b.a.Item,null,n("content",{rules:[{required:!0,message:"Please enter content for your post"}]})(o.a.createElement(v.a,null)))),o.a.createElement("div",{className:"mt3 flex flex-row justify-end"},o.a.createElement(p.a,{className:"mr2",onClick:U,disabled:x},"Preview"),o.a.createElement(p.a,{type:"primary",onClick:B,loading:x},"Create new post")),t.getFieldValue("content")&&I&&o.a.createElement("div",{className:"mt3 w-100 ba b--light-gray pa4 br3 relative"},o.a.createElement("div",{className:"flex flex-row items-center"},o.a.createElement(v.E,{imageData:Object(h.j)(E.postPub),pub:E.postPub,name:E.displayName}),o.a.createElement("div",{className:"w-100 ml3 bg-near-white pa2 mv1"})),t.getFieldValue("title")&&o.a.createElement("span",{className:"db mt3 b f4"},t.getFieldValue("title")),o.a.createElement(v.t,{hideFade:!0,className:"mt3"},t.getFieldValue("content"))))}))}));t.default=function(e){var t=e.prefilledTag;return o.a.createElement(o.a.Fragment,null,o.a.createElement(O.a,null,o.a.createElement("title",null,"Discussions App - Create New Post")),o.a.createElement(k,{prefilledTag:t}))}}}]);